# This GitHub Actions workflow is designed to deploy the WPMoo framework
# to the WordPress.org plugin repository via SVN when a new version tag is pushed.

name: Deploy to WordPress.org

on:
  push:
    tags:
      - 'v[0-9]+.[0-9]+.[0-9]+*' # Trigger on version tags like v1.2.3, v1.2.3-alpha.1

jobs:
  plugin_deploy:
    name: Deploy plugin to WordPress.org
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: WordPress.org Plugin Deploy
        uses: 10up/actions-wordpress.org-plugin-deploy@stable
        with:
          # The slug of your plugin on WordPress.org.
          # This needs to match the plugin's URL slug.
          slug: wpmoo

          # The build step to run before deploying.
          # This prepares the assets and dependencies for the distributable version.
          # 1. Install Composer dependencies without dev packages.
          # 2. Install Node.js dependencies.
          # 3. Run the WPMoo build command non-interactively.
          build-step: |
            composer install --no-dev --optimize-autoloader
            npm install
            php vendor/bin/moo build --no-interaction
        env:
          # These secrets must be configured in the GitHub repository settings.
          # See: Settings > Secrets and variables > Actions
          SVN_USERNAME: ${{ secrets.SVN_USERNAME }}
          SVN_PASSWORD: ${{ secrets.SVN_PASSWORD }}